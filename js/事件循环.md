## 事件循环
事件循环是基于任务队列的

### 任务队列
一个事件循环中，可以有一个或多个任务队列，来自于不同任务源的任务放在同一个任务队列中<br>
任务源有以下类型setTimeout、promise、click事件、ajax onload事件、I/O等<br>
而任务分为宏任务和微任务，宏任务在宏任务队列，微任务在微任务队列

### 事件循环流程
一次循环操作称为tick，关键步骤如下：
1. 取出最先进入队列的任务，如果有则执行
2. 如果微任务队列存在微任务，则不断执行，直到清空微任务队列
3. 渲染dom
4. 重复1

### 浏览器机制
1. 先把同步任务放入执行栈
2. 异步任务有了运行结果后，就在任务队列中放置一个事件
3. 执行栈中所有同步任务执行完，也可以说每次执行栈里面执行的代码就是一个宏任务
4. 取出任务队列里面可执行的任务添加到执行栈中，开始执行，先执行微任务（promise），再执行宏任务（setTimeout）

### 真题
```js
document.body.addEventListener('click', () => {
  Promise.resolve().then(()=>console.log(1));
  console.log(2)
  setTimeout(() => console.log(5), 0)
});
document.body.addEventListener('click', () => {
  Promise.resolve().then(()=>console.log(3));
  console.log(4)
  setTimeout(() => console.log(6), 0)
});
```
### 真题答案
2 - 1 - 4 -3 - 5 - 6

### 真题解析
1. 首先先把同步任务放入执行栈，
2. click事件为一个事件源，回调函数是其任务队列中的任务
3. 首先先取出第一个click事件中的任务，放到执行栈，执行
4. 执行过程中，先执行同步代码，输出2
5. 执行宏任务中产生的微任务，输出1
6. 将宏任务中产生的宏任务放到任务队列中
8. 渲染
9. 取出第二个click事件中的任务，，放到执行栈，执行
10. 执行过程中，先执行同步代码，输出4
11. 执行宏任务中产生的微任务，输出3
12. 将宏任务中产生的宏任务放到任务队列中
13. 渲染
13. 在执行栈中执行第一个click回调产生的宏任务：setTimeout，输出5
14. 渲染
15. 在执行栈中执行第二个click回调产生的宏任务：setTimeout，输出6
16. 渲染